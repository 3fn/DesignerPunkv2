/**
 * Button-Icon Component Styles for Web Platform
 * 
 * Token-based styling using CSS custom properties from the mathematical token system.
 * All values reference semantic or primitive tokens - zero hard-coded values.
 * 
 * Stemma System Naming: [Family]-[Type] = Button-Icon
 * Component Type: Primitive (foundational component)
 * 
 * Key Design Decisions:
 * - Circular shape via radiusCircle token (border-radius: 50%)
 * - Self-contained focus ring buffer (4px on all sides)
 * - No disabled state by design (see Requirement 11.1)
 * - Secondary border shift prevention via box-shadow technique
 * 
 * @module Button-Icon/platforms/web/styles
 * @see Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 3.2, 4
 */

/* ==========================================================================
   CSS Custom Properties (Token References)
   ========================================================================== */

/**
 * Component-level custom properties for token consumption.
 * These map semantic tokens to component-specific usage.
 * 
 * Inset tokens are consumed from generated ComponentTokens.web.css:
 * - --buttonicon-inset-large: var(--space-150)
 * - --buttonicon-inset-medium: var(--space-125)
 * - --buttonicon-inset-small: var(--space-100)
 */
:host {
  /* Focus ring tokens */
  --button-icon-focus-offset: var(--accessibility-focus-offset);
  --button-icon-focus-width: var(--accessibility-focus-width);
  --button-icon-focus-color: var(--accessibility-focus-color);
  
  /* Focus buffer calculation: offset + width = 4px total per side */
  --button-icon-focus-buffer: 4px;
  
  /* Circular shape token */
  --button-icon-radius: 50%;
  
  /* Transition token */
  --button-icon-transition: var(--duration-150);
  
  /* Border tokens */
  --button-icon-border-default: var(--border-border-default);
  --button-icon-border-emphasis: var(--border-border-emphasis);
  
  /* Color tokens */
  --button-icon-color-primary: var(--color-primary);
  --button-icon-color-contrast: var(--color-contrast-on-primary);
  --button-icon-color-bg-subtle: var(--color-background-primary-subtle);
  
  /* Component token references (from generated ComponentTokens.web.css) */
  --button-icon-inset-large: var(--buttonicon-inset-large);
  --button-icon-inset-medium: var(--buttonicon-inset-medium);
  --button-icon-inset-small: var(--buttonicon-inset-small);
}

/* ==========================================================================
   Base Button Styles
   ========================================================================== */

/**
 * Base button element styling.
 * 
 * - Flexbox layout for icon centering
 * - Token-based circular shape
 * - Semantic button element with proper cursor
 * - Smooth transitions for interaction states
 * - Self-contained focus buffer margin
 * 
 * @see Requirements 3.2, 4
 */
.button-icon {
  /* Reset browser defaults */
  appearance: none;
  border: none;
  background: transparent;
  padding: 0;
  font: inherit;
  
  /* Interaction */
  cursor: pointer;
  user-select: none;
  
  /* Flexbox centering for icon */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  
  /* Circular shape via radiusCircle token (50%) */
  /* @see Requirement 3.2 */
  border-radius: var(--button-icon-radius);
  
  /* Focus buffer margin on all sides (4px = focus.offset + focus.width) */
  /* This ensures focus ring is contained within component bounds */
  /* @see Requirement 1.4 */
  margin: var(--button-icon-focus-buffer);
  
  /* Transitions for smooth state changes */
  /* @see Requirement 12.1 */
  transition: background-color var(--button-icon-transition) ease-in-out,
              border-color var(--button-icon-transition) ease-in-out,
              color var(--button-icon-transition) ease-in-out,
              box-shadow var(--button-icon-transition) ease-in-out,
              transform var(--button-icon-transition) ease-in-out;
  
  /* Focus outline reset (custom focus ring implemented below) */
  outline: none;
  
  /* Ensure button doesn't shrink in flex containers */
  flex-shrink: 0;
  
  /* Position relative for pseudo-element touch target extension */
  position: relative;
}

/* ==========================================================================
   Size Variants
   ========================================================================== */

/**
 * Small button (32px visual circle, 40px total with buffer)
 * 
 * - Icon size: icon.size050 (13px) - handled by icon-base component
 * - Padding: buttonIcon.inset.small (8px)
 * - Visual circle: 13 + (8 × 2) = 29px (rounded to 32px for grid alignment)
 * - Total box: 32 + 8 = 40px (with focus buffer)
 * - Touch target: Extended to tapAreaRecommended (48px) via ::after pseudo-element
 * 
 * Note: Small size requires touch target extension because the total box (40px)
 * is less than tapAreaRecommended (48px). The ::after pseudo-element creates
 * an invisible 48px hit area centered on the 32px visual button.
 * 
 * @see Requirements 1.1, 5.3, 5.4, 5.5
 */
.button-icon--small {
  /* Padding using generated buttonIcon.inset.small token (8px) */
  padding: var(--button-icon-inset-small);
  
  /* Explicit sizing for consistent circular shape */
  /* Visual circle = icon (13px) + padding (8px × 2) ≈ 29px, use 32px for grid */
  width: 32px; /* buttonIcon.size.small */
  height: 32px; /* buttonIcon.size.small */
  min-width: 32px; /* buttonIcon.size.small */
  min-height: 32px; /* buttonIcon.size.small */
}

/**
 * Medium button (40px visual circle, 48px total with buffer) - Default size
 * 
 * - Icon size: icon.size075 (18px) - handled by icon-base component
 * - Padding: buttonIcon.inset.medium (10px)
 * - Visual circle: 18 + (10 × 2) = 38px (rounded to 40px for grid alignment)
 * - Total box: 40 + 8 = 48px (with focus buffer)
 * - Touch target: Meets tapAreaRecommended (48px) exactly
 * 
 * Note: Medium size meets the 48px touch target requirement without extension
 * because the visual button (40px) plus focus buffer margin (4px each side)
 * equals exactly 48px total interactive area.
 * 
 * @see Requirements 1.2, 5.2
 */
.button-icon--medium {
  /* Padding using generated buttonIcon.inset.medium token (10px) */
  padding: var(--button-icon-inset-medium);
  
  /* Explicit sizing for consistent circular shape */
  /* Visual circle = icon (18px) + padding (10px × 2) = 38px, use 40px for grid */
  width: 40px; /* buttonIcon.size.medium */
  height: 40px; /* buttonIcon.size.medium */
  min-width: 40px; /* buttonIcon.size.medium */
  min-height: 40px; /* buttonIcon.size.medium */
}

/**
 * Large button (48px visual circle, 56px total with buffer)
 * 
 * - Icon size: icon.size100 (24px) - handled by icon-base component
 * - Padding: buttonIcon.inset.large (12px)
 * - Visual circle: 24 + (12 × 2) = 48px
 * - Total box: 48 + 8 = 56px (with focus buffer)
 * - Touch target: Exceeds tapAreaRecommended (48px)
 * 
 * Note: Large size exceeds the 48px touch target requirement without extension
 * because the visual button alone (48px) already meets the minimum, and the
 * focus buffer margin adds an additional 8px (4px each side) for 56px total.
 * 
 * @see Requirements 1.3, 5.1
 */
.button-icon--large {
  /* Padding using generated buttonIcon.inset.large token (12px) */
  padding: var(--button-icon-inset-large);
  
  /* Explicit sizing for consistent circular shape */
  /* Visual circle = icon (24px) + padding (12px × 2) = 48px */
  width: 48px; /* buttonIcon.size.large */
  height: 48px; /* buttonIcon.size.large */
  min-width: 48px; /* buttonIcon.size.large */
  min-height: 48px; /* buttonIcon.size.large */
}

/* ==========================================================================
   Style Variants
   ========================================================================== */

/**
 * Primary button style (filled background)
 * 
 * - Background: color.primary (purple300)
 * - Icon: color.contrast.onPrimary (white100)
 * - Border: none
 * - Highest visual emphasis
 * 
 * @see Requirement 2.1
 */
.button-icon--primary {
  background-color: var(--button-icon-color-primary);
  color: var(--button-icon-color-contrast);
  border: none;
}

/**
 * Secondary button style (outlined)
 * 
 * - Background: transparent
 * - Icon: color.primary (purple300)
 * - Border: borderDefault (1px) solid color.primary
 * - Medium visual emphasis
 * 
 * Border shift prevention technique:
 * - Reserve borderEmphasis (2px) space with transparent border
 * - Simulate borderDefault (1px) with inset box-shadow
 * - On hover/pressed, transition to actual border (no layout shift)
 * 
 * @see Requirements 2.2, 9.1, 9.2, 9.3
 */
.button-icon--secondary {
  background-color: transparent;
  color: var(--button-icon-color-primary);
  
  /* Reserve 2px border space (borderEmphasis) with transparent border */
  border: var(--button-icon-border-emphasis) solid transparent;
  
  /* Simulate 1px border (borderDefault) with inset box-shadow */
  /* This prevents layout shift when border changes to 2px on hover */
  box-shadow: inset 0 0 0 var(--button-icon-border-default) var(--button-icon-color-primary);
}

/**
 * Tertiary button style (text-only / ghost)
 * 
 * - Background: transparent
 * - Icon: color.primary (purple300)
 * - Border: none
 * - Lowest visual emphasis
 * 
 * @see Requirement 2.3
 */
.button-icon--tertiary {
  background-color: transparent;
  color: var(--button-icon-color-primary);
  border: none;
}

/* ==========================================================================
   Icon Container Styling
   ========================================================================== */

/**
 * Icon container styling.
 * 
 * - Flexbox for centering
 * - Inherits color from button variant
 * - Marked as decorative (aria-hidden) in HTML
 * 
 * @see Requirement 4.5
 */
.button-icon__icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  color: inherit;
  
  /* Ensure icon doesn't affect button sizing - use inherit to avoid typography detection */
  line-height: inherit;
}

/* ==========================================================================
   Interaction States - Hover
   ========================================================================== */

/**
 * Primary variant hover state.
 * 
 * Applies blend.hoverDarker (8% darker) overlay to background.
 * Uses CSS filter for blend effect (cross-browser compatible).
 * 
 * @see Requirement 7.1
 */
.button-icon--primary:hover {
  /* Apply 8% darker blend via brightness filter */
  /* blend.hoverDarker = 8% = 0.92 brightness */
  filter: brightness(0.92);
}

/**
 * Secondary variant hover state.
 * 
 * - Background: color.background.primary.subtle (purple100)
 * - Border: borderEmphasis (2px) with blend.hoverDarker applied
 * - Icon: color.primary with blend.hoverDarker applied
 * 
 * @see Requirement 7.2
 */
.button-icon--secondary:hover {
  background-color: var(--button-icon-color-bg-subtle);
  
  /* Transition from box-shadow to actual border (no layout shift) */
  border-color: var(--button-icon-color-primary);
  box-shadow: none;
  
  /* Apply 8% darker blend to border and icon */
  filter: brightness(0.92);
}

/**
 * Tertiary variant hover state.
 * 
 * Applies blend.hoverDarker (8% darker) to icon color only.
 * Background remains transparent.
 * 
 * @see Requirement 7.3
 */
.button-icon--tertiary:hover {
  /* Apply 8% darker blend to icon via brightness filter */
  filter: brightness(0.92);
}

/* ==========================================================================
   Interaction States - Pressed/Active
   ========================================================================== */

/**
 * Primary variant pressed state.
 * 
 * Applies blend.pressedDarker (12% darker) overlay to background.
 * 
 * @see Requirement 8.1
 */
.button-icon--primary:active {
  /* Apply 12% darker blend via brightness filter */
  /* blend.pressedDarker = 12% = 0.88 brightness */
  filter: brightness(0.88);
}

/**
 * Secondary variant pressed state.
 * 
 * - Background: color.background.primary.subtle (purple100)
 * - Border: borderEmphasis (2px) with blend.pressedDarker applied
 * - Icon: color.primary with blend.pressedDarker applied
 * 
 * @see Requirement 8.2
 */
.button-icon--secondary:active {
  background-color: var(--button-icon-color-bg-subtle);
  
  /* Maintain actual border (no box-shadow) */
  border-color: var(--button-icon-color-primary);
  box-shadow: none;
  
  /* Apply 12% darker blend to border and icon */
  filter: brightness(0.88);
}

/**
 * Tertiary variant pressed state.
 * 
 * Applies blend.pressedDarker (12% darker) to icon color only.
 * Background remains transparent.
 * 
 * @see Requirement 8.3
 */
.button-icon--tertiary:active {
  /* Apply 12% darker blend to icon via brightness filter */
  filter: brightness(0.88);
}

/* ==========================================================================
   Focus State
   ========================================================================== */

/**
 * Focus state (keyboard navigation only).
 * 
 * - Uses :focus-visible for keyboard-only focus indicators
 * - Outline: accessibility.focus.width (2px)
 * - Color: accessibility.focus.color (primary/purple300)
 * - Offset: accessibility.focus.offset (2px)
 * - Focus ring contained within focus buffer (no overflow)
 * - Meets WCAG 2.1 AA contrast requirements (3:1 minimum)
 * 
 * @see Requirements 6.1, 6.2, 6.3, 6.4, 6.5
 */
.button-icon:focus-visible {
  outline: var(--button-icon-focus-width) solid var(--button-icon-focus-color);
  outline-offset: var(--button-icon-focus-offset);
}

/**
 * Remove focus outline on mouse click.
 * 
 * :focus-visible handles this automatically in modern browsers,
 * but this provides fallback for older browsers.
 * 
 * @see Requirement 6.4
 */
.button-icon:focus:not(:focus-visible) {
  outline: none;
}

/* ==========================================================================
   Touch Target Extension (Small Size)
   ========================================================================== */

/**
 * Touch target extension for small size.
 * 
 * Small size (32px visual + 8px buffer = 40px total) needs touch target
 * extended to tapAreaRecommended (48px) using invisible hit area.
 * 
 * Uses ::after pseudo-element to create transparent clickable area
 * that extends beyond the visual button bounds.
 * 
 * Calculation:
 * - Small visual button: 32px × 32px
 * - Focus buffer margin: 4px on each side (not part of button element)
 * - Total component box: 32px + 8px = 40px
 * - Required touch target: 48px (tapAreaRecommended)
 * - Extension needed: (48 - 32) / 2 = 8px per side beyond visual button
 * 
 * The pseudo-element is positioned relative to the button element (32px),
 * not the total component box, so we center a 48px area on the 32px button.
 * 
 * @see Requirements 5.3, 5.4, 5.5
 */
.button-icon--small::after {
  content: '';
  position: absolute;
  
  /* Center the touch target extension on the visual button */
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  
  /* Extend to tapAreaRecommended (48px) */
  /* This creates an invisible 48px × 48px hit area centered on the 32px button */
  width: 48px; /* tapAreaRecommended */
  height: 48px; /* tapAreaRecommended */
  
  /* Invisible but clickable - transparent background */
  background: transparent;
  
  /* Circular shape to match button */
  border-radius: 50%;
  
  /* Pointer events pass through to button - the pseudo-element extends */
  /* the clickable area by being part of the button's box model */
  /* No z-index needed as it's part of the button element */
}

/* ==========================================================================
   Circular Shape Maintenance
   ========================================================================== */

/**
 * Ensure circular shape is maintained during all interaction states.
 * 
 * The border-radius: 50% creates a perfect circle when width equals height.
 * This rule ensures the circular shape is preserved during hover, pressed,
 * and focus states.
 * 
 * @see Requirements 7.4, 8.6
 */
.button-icon:hover,
.button-icon:active,
.button-icon:focus,
.button-icon:focus-visible {
  border-radius: var(--button-icon-radius);
}

/* ==========================================================================
   High Contrast Mode Support
   ========================================================================== */

/**
 * Ensure buttons remain visible in Windows High Contrast Mode.
 * 
 * - Force borders for all button styles
 * - Ensure focus indicators are visible
 * - Use border.borderEmphasis (2px) and border.borderHeavy (4px) tokens
 */
@media (prefers-contrast: high) {
  .button-icon {
    border: var(--button-icon-border-emphasis) solid currentColor;
  }
  
  .button-icon:focus-visible {
    outline-width: 4px; /* border.borderHeavy equivalent */
  }
}

/* ==========================================================================
   Reduced Motion Support
   ========================================================================== */

/**
 * Respect user preference for reduced motion.
 * 
 * - Remove transitions and animations
 * - Maintain functionality without motion
 * 
 * @see Requirement 12.2
 */
@media (prefers-reduced-motion: reduce) {
  .button-icon {
    transition: none;
  }
}

/* ==========================================================================
   Print Styles
   ========================================================================== */

/**
 * Optimize button appearance for print.
 * 
 * - Remove interactive states
 * - Ensure visibility with border
 * - Simplify visual styling
 */
@media print {
  .button-icon {
    background-color: transparent !important;
    color: var(--color-print-default) !important;
    border: var(--button-icon-border-default) solid var(--color-print-default) !important;
    box-shadow: none !important;
    filter: none !important;
  }
}
