version: "1.0.0"
component: Progress-Stepper-Detailed
family: Progress-Indicator

contracts:
  composition_all_primitives:
    category: composition
    description: Renders Node-Base, Connector-Base, and Label-Base primitives
    behavior: |
      Composes Node-Base for each step, Connector-Base between adjacent nodes
      (n-1 for n nodes), and Label-Base for each step.
      Completed nodes receive content='checkmark' (icon precedence).
      Current/incomplete/error nodes with icon receive content='icon'.
      Current/incomplete/error nodes without icon receive content='none'.
    wcag: null
    platforms: [web, ios, android]
    validation:
      - Renders Node-Base for each step
      - Renders Connector-Base between all adjacent nodes
      - Renders Label-Base for each step
      - Completed nodes have content='checkmark'
      - Non-completed nodes with icon have content='icon'
      - Non-completed nodes without icon have content='none'
    test_approach: |
      Render with 4 steps, currentStep=2, icon on step 3. Verify 4 nodes,
      3 connectors, 4 labels. Verify completed=checkmark, step 3=icon.
    required: true

  composition_icon_precedence:
    category: composition
    description: Completed steps always show checkmark, user icon only for other states
    behavior: |
      Icon precedence rules:
      - Completed: ALWAYS checkmark (user-provided icon ignored)
      - Current/incomplete/error with icon: renders user icon
      - Current/incomplete/error without icon: empty circle (none)
    wcag: null
    platforms: [web, ios, android]
    validation:
      - Completed nodes always render checkmark
      - User icon ignored for completed nodes
      - User icon rendered for current/incomplete/error nodes
      - No icon renders as empty circle
    test_approach: |
      Render completed step with user icon — verify checkmark shown,
      user icon ignored. Render current step with icon — verify user icon.
    required: true

  state_priority_derivation:
    category: state
    description: Derives state with priority error > completed > current > incomplete
    behavior: |
      State derivation uses priority logic (same as Stepper-Base):
      1. error: step index in errorSteps (highest priority)
      2. completed: step index < currentStep and not in errorSteps
      3. current: step index === currentStep and not in errorSteps
      4. incomplete: step index > currentStep
    wcag: null
    platforms: [web, ios, android]
    validation:
      - Error steps override all other states
      - Steps before currentStep are completed (unless error)
      - Exactly one step is current (unless in errorSteps)
      - Steps after currentStep are incomplete
    test_approach: |
      Render with currentStep=2, errorSteps=[1]. Verify step 1 is error,
      step 2 is current, step 3+ incomplete.
    required: true

  state_connector_derivation:
    category: state
    description: Connectors are active between completed nodes, inactive otherwise
    behavior: |
      Connector state derived from adjacent node states:
      - active: both left and right nodes are completed
      - inactive: any other combination
    wcag: null
    platforms: [web, ios, android]
    validation:
      - Connectors between completed nodes are active
      - All other connectors are inactive
    test_approach: |
      Render with currentStep=3. Verify connector between completed nodes
      is active, others inactive.
    required: true

  accessibility_list_role:
    category: accessibility
    description: Uses role="list" with role="listitem" per step
    behavior: |
      Uses role="list" with each step as role="listitem".
      Error steps include "error" suffix in aria-label.
      Optional steps include "optional" suffix in aria-label.
      Screen reader announces "Step X of Y: [label]".
    wcag: "4.1.2 Name, Role, Value"
    platforms: [web, ios, android]
    validation:
      - role="list" applied to container (web)
      - role="listitem" applied to each step (web)
      - Error steps have "error" in aria-label
      - Optional steps have "optional" in aria-label
    test_approach: |
      Render stepper. Verify role="list" on container, role="listitem"
      on each step (web). Verify error step aria-label includes "error".
    required: true

  validation_size_restriction:
    category: validation
    description: Throws error if size='sm' is used
    behavior: |
      Steppers only support sizes 'md' and 'lg'. If size='sm' is provided,
      the component throws an error.
    wcag: null
    platforms: [web, ios, android]
    validation:
      - size='sm' throws error
      - size='md' renders correctly
      - size='lg' renders correctly
    test_approach: |
      Render with size='sm' — verify error thrown. Render with size='md'
      and size='lg' — verify normal rendering.
    required: true
